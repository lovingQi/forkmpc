# MPC控制器推导过程

## 一、系统建模

### 1. 非线性运动学模型
状态变量x = [x, y, φ]ᵀ，控制输入u = [v, δ]ᵀ
ẋ = v * cos(φ)
ẏ = v * sin(φ)
φ̇ = v * tan(δ)/L

### 2. 线性化
在参考轨迹点(xᵣ, uᵣ)处进行泰勒展开：
Δẋ = A * Δx + B * Δu

其中：
A = [∂f/∂x]|_{x=xᵣ,u=uᵣ} = 
    [0   0   -v*sin(φ)]
    [0   0    v*cos(φ)]
    [0   0    0      ]

B = [∂f/∂u]|_{x=xᵣ,u=uᵣ} = 
    [cos(φ)    0    ]
    [sin(φ)    0    ]
    [tan(δ)/L  v/(L*cos²(δ))]

### 3. 离散化
使用前向欧拉法离散化：
Δx(k+1) = Δx(k) + Ts * Δẋ(k)
        = (I + Ts*A) * Δx(k) + Ts*B * Δu(k)
        = Ad * Δx(k) + Bd * Δu(k)

## 二、预测控制设计

### 1. 增广状态空间模型
为了消除稳态误差，引入增广状态向量：
ξ(k) = [Δx(k)ᵀ, u(k-1)ᵀ]ᵀ

增广系统方程：
ξ(k+1) = Ã * ξ(k) + B̃ * Δu(k)
y(k) = C̃ * ξ(k)

其中：
Ã = [Ad  Bd]
    [0   I ]

B̃ = [Bd]
    [I ]

C̃ = [I  0]

### 2. 预测方程
在时刻k，预测未来Np步的系统输出：
Y = Φ * ξ(k) + Γ * ΔU

其中：
Y = [y(k+1|k), y(k+2|k), ..., y(k+Np|k)]ᵀ
ΔU = [Δu(k|k), Δu(k+1|k), ..., Δu(k+Nc-1|k)]ᵀ

Φ和Γ的构建方式与当前readme中的Ψ和Θ略有不同：
Φ = [C̃Ã]
    [C̃Ã²]
    [...]
    [C̃Ãᴺᵖ]

Γ = [C̃B̃       0       ...  0    ]
    [C̃ÃB̃      C̃B̃      ...  0    ]
    [C̃Ã²B̃     C̃ÃB̃     ...  0    ]
    [...]
    [C̃Ãᴺᵖ⁻¹B̃  C̃Ãᴺᵖ⁻²B̃  ...  C̃Ãᴺᵖ⁻ᴺᶜB̃]

### 3. 目标函数
J = (Y - Yref)ᵀQ(Y - Yref) + ΔUᵀRΔU

转化为标准QP形式：
J = 1/2 * ΔUᵀHΔU + fᵀΔU

其中：
H = ΓᵀQΓ + R
f = Γᵀ(Φξ(k) - Yref)

### 4. 约束条件
输入约束：
umin ≤ u(k) ≤ umax
Δumin ≤ Δu(k) ≤ Δumax

状态约束：
xmin ≤ x(k) ≤ xmax

## 主要区别：
1. 视频中更强调了增广状态的物理意义
2. 预测矩阵的构建方式更直观
3. 约束处理更完整，包含了状态约束
4. 目标函数的构建考虑了参考轨迹的跟踪
